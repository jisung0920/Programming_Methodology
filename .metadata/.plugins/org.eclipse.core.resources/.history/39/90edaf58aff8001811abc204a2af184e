package BankSystems;

import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.ArrayList;

import javax.swing.JOptionPane;

import BankObjects.Bank;
import BankObjects.Customer;
import BankObjects.Manager;
import BankPanelUI.customerMain;
import BankPanelUI.loginWindow;
import BankPanelUI.managerMain;
import BankPanelUI.startBanking;

public class BankSystemController {

	private BankView view;
	private Manager bankManager;
	private int usingCustomer,usingAccount;
	
	public BankSystemController(BankView view, Manager manager) {
		this.view  = view;
		this.bankManager = manager;
		usingCustomer=0;
		usingAccount =0;

	}
	public void processBanking() {
		startBanking start = new startBanking();
		setStartBanking(start);

		view.attachPanel(start);
//		view.setLogin();
	}
	
	public void setStartBanking(startBanking panel) {
		this.view.setStart(panel);
		panel.valueSetting();
		panel.viewSetting();
		panel.addToPanel();
		panel.getCreateBtn().addActionListener(new ActionListener() {
			
			@Override
			public void actionPerformed(ActionEvent e) {
				String bankName = panel.getBankName().getText();
				view.setTitle(bankName);
				bankManager.makeBank(bankName);
				setLoginWindow(new loginWindow());
				view.goTologin();
			}
		});	
	}
	public void setLoginWindow(loginWindow panel) {
		this.view.setLogin(panel);
		panel.valueSetting();
		panel.viewSetting();
		panel.addToPanel();
		panel.getcLoginBtn().addActionListener(new ActionListener() {
			
			@Override
			public void actionPerformed(ActionEvent e) {
				// TODO Auto-generated method stub
				Bank bank = bankManager.getBank();
				ArrayList<Customer> customer = bank.getCustomers();
				String id,pw;
				id = panel.getCustomerId().getText();
				pw = panel.getCustomerPw().getText();
				for(int i=0;i<customer.size();i++) {
					if(customer.get(i).identifyCustomer(id, pw)) {
						setCustomerMain(new customerMain());
						view.goTocustom();
					}
				}
				JOptionPane.showMessageDialog(panel, "아이디와 패스워드를 확인하세요.","로그인 실패",JOptionPane.WARNING_MESSAGE);
				
//				bank.hasId(id)
				
			}
		});
		
		panel.getNewCustomerBtn().addActionListener(new ActionListener() {
			
			@Override
			public void actionPerformed(ActionEvent e) {
				// TODO Auto-generated method stub
				Bank bank = bankManager.getBank();
				Customer customer = new Customer(view.getLogin().getCustomerId().getText(),view.getLogin().getCustomerPw().getText(),view.getLogin().getCustomerName().getText());
				bank.getCustomers().add(customer);
	
			}
		});
		
		panel.getmLoginBtn().addActionListener(new ActionListener() {
			
			@Override
			public void actionPerformed(ActionEvent e) {
				// TODO Auto-generated method stub
				String id = panel.getManagerId().getText();
				String pw = panel.getManagerPw().getText();
				System.out.println(id+"/"+pw);
				setManagerMain(new managerMain());
				if(bankManager.login(id, pw))
					view.goTomanage();
				else
					System.out.println("wrong");
			}
		});
	}
	public void setManagerMain(managerMain panel) {
		this.view.setManage(panel);
		System.out.println("bank2");
		panel.valueSetting(this.bankManager.getBank());
		panel.viewSetting();
		panel.addToPanel();
		
		panel.getSettingBtn().addActionListener(new ActionListener() {
			
			@Override
			public void actionPerformed(ActionEvent e) {
				// TODO Auto-generated method stub
				int charge = Integer.parseInt(panel.getChargeValue().getText());
				float interest = Float.parseFloat(panel.getInterestValue().getText());
				bankManager.getBank().setCharge(charge);
				bankManager.getBank().setInterest(interest);
				System.out.println(charge+"/"+interest);
			}
		});
		panel.getBackBtn().addActionListener(new ActionListener() {
			
			@Override
			public void actionPerformed(ActionEvent e) {
				// TODO Auto-generated method stub
				view.goTologin();
			}
		});
	}

	public void setCustomerMain(customerMain panel) {
		this.view.setCustom(panel);
		panel.valueSetting(bankManager.getBank().getCustomers().get(0));
		panel.viewSetting();
		panel.addToPanel();
		panel.getBackBtn().addActionListener(new ActionListener() {
			
			@Override
			public void actionPerformed(ActionEvent e) {
				// TODO Auto-generated method stub
				view.goTologin();
			}
		});
		panel.getCreateAccountBtn().addActionListener(new ActionListener() {
			
			@Override
			public void actionPerformed(ActionEvent e) {
				// TODO Auto-generated method stub
//				bankManager.getBank().getCustomers().get(0).getAccounts().add(new Account())
				
			}
		});
		
	}

}
